<div class="profile-container" *ngIf="!loading && user; else loadingOrError">
  <div class="profile-card">
    <img
  [src]="
    user?.profileImage
      ? (user.profileImage.startsWith('http')
          ? user.profileImage
          : 'http://localhost:5050/uploads/' + user.profileImage)
      : '/profile-icon.svg'
  "
  alt="{{ user?.name || 'Profile Image' }}"
  title="{{ user?.name || 'Profile Image' }}"
  class="profile-image"
/>

    <div *ngIf="!editing; else editForm">
      <h2>{{ user?.name }}</h2>
      <p><strong>Email:</strong> {{ user?.email }}</p>
      <p><strong>Major:</strong> {{ user?.major }}</p>
      <p><strong>Graduation Year:</strong> {{ user?.graduationYear }}</p>
      <p><strong>Bio:</strong> {{ user?.bio }}</p>
      <button (click)="toggleEdit()">Edit Profile</button>
    </div>

    <ng-template #editForm>
      <h3>Edit Profile</h3>
      <form (ngSubmit)="saveChanges()">
        <input [(ngModel)]="updatedUser.name" name="name" placeholder="Name" />
        <input [(ngModel)]="updatedUser.email" name="email" placeholder="Email" />
        <input [(ngModel)]="updatedUser.major" name="major" placeholder="Major" />
        <input [(ngModel)]="updatedUser.graduationYear" name="graduationYear" placeholder="Graduation Year" />

        <label for="profileImage"><strong>Profile Image</strong></label>
        <input type="file" id="profileImage" (change)="onFileSelected($event)" />
        <img *ngIf="previewImage" [src]="previewImage" alt="Profile Preview" class="preview-image" />
        <button type="button" (click)="removeImage()" class="remove-btn">Remove Image</button>

        <textarea [(ngModel)]="updatedUser.bio" name="bio" placeholder="Bio"></textarea>

        <div class="buttons">
          <button type="submit">Save</button>
          <button type="button" (click)="toggleEdit()">Cancel</button>
        </div>
      </form>
    </ng-template>
  </div>
</div>

<ng-template #loadingOrError>
  <div class="profile-status">
    <p *ngIf="loading">Loading profile...</p>
    <p *ngIf="errorMessage">{{ errorMessage }}</p>
  </div>
</ng-template>